{% extends "base.html" %}

{% block title %}–ú—É–ª—å—Ç–∏–≤–∞—Ä–∫–∞{% endblock %}

{% block content %}

<!-- –°–µ–∫—Ü–∏—è —Å —Ä–µ—Ü–µ–ø—Ç–æ–º -->
{% if recipe %}
    <div class="recipe-header mb-4">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
            <h2 class="mb-3 mb-lg-0">
                <i class="fas fa-utensils me-2"></i>–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç
            </h2>
            <div class="recipe-actions d-flex flex-column flex-sm-row gap-2">
                <button class="btn btn-success" onclick="optimizeRecipe()">
                    <i class="fas fa-magic me-2"></i>–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç
                </button>
            </div>

        </div>
    </div>
        
        <!-- –ù–∞–∑–≤–∞–Ω–∏—è –±–ª—é–¥ -->
        <div class="recipe-header mb-4">
            <div class="row g-2">
                {% for meal_name, meal_data in recipe.–º–µ–Ω—é.items() %}
                    {% if '–±–ª—é–¥–æ' in meal_data %}
                    <div class="col-12 col-sm-6 col-md-4 mb-2">
                        <div class="meal-card {{ meal_name }} {% if meal_data.get('skip_cooking', False) %}meal-card-skipped{% endif %}" style="cursor: pointer;">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1" onclick="scrollToRecipe('{{ meal_name }}')">
                                    <h5 class="meal-title">
                                        <i class="fas fa-clock me-2"></i>{{ meal_name|title }}
                                    </h5>
                                    <p class="meal-dish">{{ meal_data.–±–ª—é–¥–æ }}</p>
                                </div>
                                <div class="d-flex gap-1">
                                    <button class="btn btn-sm btn-outline-primary" 
                                            onclick="replaceMeal('{{ meal_name }}')" 
                                            title="–ó–∞–º–µ–Ω–∏—Ç—å –±–ª—é–¥–æ">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" 
                                            onclick="toggleSkipCooking('{{ meal_name }}')" 
                                            title="{% if meal_data.get('skip_cooking', False) %}–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ{% else %}–ù–µ –≥–æ—Ç–æ–≤–∏—Ç—å{% endif %}"
                                            id="skip-btn-{{ meal_name }}">
                                        <i class="fas {% if meal_data.get('skip_cooking', False) %}fa-play{% else %}fa-pause{% endif %}"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- 1. –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ -->
        {% if needed_products %}
            <div class="row g-3" id="shopping-list-container">
                {% for product, info in needed_products.items() %}
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="product-card">
                        <div class="product-header">
                            <h5 class="mb-0">
                                <i class="fas fa-shopping-cart me-2"></i>{{ product|title }}
                            </h5>
                        </div>
                        <div class="product-body">
                            <div class="mb-3">
                                <div class="text-center">
                                    {% if info.get('—Ç–∏–ø', 'quantity') == 'availability' %}
                                        <div class="info-display">
                                            <strong>–ù—É–∂–Ω–æ: {{ info.–µ–¥–∏–Ω–∏—Ü–∞ }}</strong>
                                        </div>
                                        {% if info.–µ—Å—Ç—å > 0 %}
                                        <div class="info-display-secondary">
                                            –ï—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏
                                        </div>
                                        {% endif %}
                                    {% else %}
                                        <div class="info-display">
                                            <strong>–ù—É–∂–Ω–æ: {{ info.–Ω—É–∂–Ω–æ|format_number }} {{ info.–µ–¥–∏–Ω–∏—Ü–∞ }}</strong>
                                        </div>
                                        {% if info.–µ—Å—Ç—å > 0 %}
                                        <div class="info-display-secondary">
                                            –ï—Å—Ç—å: {{ info.–µ—Å—Ç—å|format_number }} {{ info.–µ–¥–∏–Ω–∏—Ü–∞ }}
                                        </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ -->
                            <div class="text-center mb-3">
                                {% if info.get('—Ç–∏–ø', 'quantity') == 'availability' %}
                                    {% if info.–µ—Å—Ç—å > 0 %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>–ï—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏
                                        </span>
                                    {% else %}
                                        <span class="badge bg-danger">
                                            <i class="fas fa-exclamation-triangle me-1"></i>–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å
                                        </span>
                                    {% endif %}
                                {% else %}
                                    {% if info.–µ—Å—Ç—å >= info.–Ω—É–∂–Ω–æ %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
                                        </span>
                                    {% elif info.–µ—Å—Ç—å > 0 %}
                                        <span class="badge bg-warning text-dark">
                                            <i class="fas fa-exclamation-circle me-1"></i>–ù—É–∂–Ω–æ –¥–æ–∫—É–ø–∏—Ç—å
                                        </span>
                                    {% else %}
                                        <span class="badge bg-danger">
                                            <i class="fas fa-exclamation-triangle me-1"></i>–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å
                                        </span>
                                    {% endif %}
                                {% endif %}
                            </div>
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏ -->
                            <div class="d-grid">
                                {% if info.get('—Ç–∏–ø', 'quantity') == 'availability' %}
                                    <button class="btn btn-success btn-custom" onclick="buyProductAvailability('{{ product }}', '{{ info.–µ–¥–∏–Ω–∏—Ü–∞ }}')">
                                        <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏–ª
                                    </button>
                                {% else %}
                                    <button class="btn btn-success btn-custom" onclick="buyProduct('{{ product }}', {{ info.–Ω—É–∂–Ω–æ|format_number }}, '{{ info.–µ–¥–∏–Ω–∏—Ü–∞ }}')">
                                        <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏–ª
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-check-circle text-success"></i>
                <h3>–í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –µ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–µ!</h3>
                <p>üéâ –ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –ø–æ–∫—É–ø–∞—Ç—å</p>
            </div>
        {% endif %}

        <!-- –†–µ—Ü–µ–ø—Ç—ã –ø–æ –ø–æ—Ä—è–¥–∫—É –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏ -->
        {% set meal_order = ['–∑–∞–≤—Ç—Ä–∞–∫', '–≤—Ç–æ—Ä–æ–π_–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫', '—É–∂–∏–Ω'] %}
        
        <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã -->
        {% set active_meals = [] %}
        {% for meal_name in meal_order %}
            {% if meal_name in recipe.–º–µ–Ω—é and '–±–ª—é–¥–æ' in recipe.–º–µ–Ω—é[meal_name] and not recipe.–º–µ–Ω—é[meal_name].get('skip_cooking', False) %}
                {% set _ = active_meals.append(meal_name) %}
            {% endif %}
        {% endfor %}
        
        {% if active_meals %}
        <div class="cooking-stage-divider mb-4">
            <div class="text-center">
                <h3 class="stage-title">
                    <i class="fas fa-utensils me-2"></i>–†–µ—Ü–µ–ø—Ç—ã
                </h3>
                
            </div>
        </div>
        
        <div class="row g-4">
            {% for meal_name in active_meals %}
                {% set meal_data = recipe.–º–µ–Ω—é[meal_name] %}
                    <div class="col-12">
                        <div class="product-card {% if meal_data.get('–≥–æ—Ç–æ–≤–æ', False) %}ready-meal{% endif %} large-recipe-card {{ meal_name }}" id="recipe-{{ meal_name }}">
                            <div class="product-header">
                                <h4 class="mb-0">
                                    <i class="fas fa-utensils me-2"></i>{{ meal_name|title }}: {{ meal_data.–±–ª—é–¥–æ }}
                                </h4>
                            </div>
                            <div class="product-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="ingredients-list mb-4">
                                            <h5><i class="fas fa-list me-2"></i>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h5>
                                            <ul class="list-unstyled">
                                                {% for ingredient in meal_data.–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã %}
                                                <li class="mb-2">
                                                    <i class="fas fa-circle me-2" style="color: #28a745; font-size: 0.8em;"></i>
                                                    <strong>{{ ingredient.–ø—Ä–æ–¥—É–∫—Ç|title }}</strong>: {{ ingredient.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ|format_number }} {{ ingredient.–µ–¥–∏–Ω–∏—Ü–∞ }}
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        {% if meal_data.get('–≥–æ—Ç–æ–≤–æ', False) %}
                                            <div class="d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center">
                                                    <span class="badge bg-success fs-5 p-3">
                                                        <i class="fas fa-check-circle me-2"></i>–ì–æ—Ç–æ–≤–æ –∫ –ø–æ–¥–∞—á–µ
                                                    </span>
                                                </div>
                                            </div>
                                        {% elif '–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏' in meal_data %}
                                            <div class="instructions-list mb-4">
                                                <h5><i class="fas fa-clipboard-list me-2"></i>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h5>
                                                <ol class="ps-3">
                                                    {% for instruction in meal_data.–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ %}
                                                    <li class="mb-2">{{ instruction }}</li>
                                                    {% endfor %}
                                                </ol>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–ª—é–¥, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å) -->
                                {% if not meal_data.get('–≥–æ—Ç–æ–≤–æ', False) %}
                                <div class="d-grid">
                                    <button class="btn btn-success btn-custom btn-lg" onclick="cookMeal('{{ meal_name }}')">
                                        <i class="fas fa-fire me-2"></i>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–æ
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
            {% endfor %}
        </div>
        {% endif %}
        


<hr class="my-5">

<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ -->
<div class="text-center mb-4">
    <h2 class="stage-title">
        <i class="fas fa-snowflake me-2"></i>–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫
    </h2>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
{% if sklad %}
    <div class="warehouse-list">
        <div class="warehouse-header">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <h6 class="mb-0"><i class="fas fa-box me-2"></i>–ü—Ä–æ–¥—É–∫—Ç</h6>
                </div>
                <div class="col-md-2 text-center">
                    <h6 class="mb-0">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ/–ù–∞–ª–∏—á–∏–µ</h6>
                </div>
                <div class="col-md-2 text-center">
                    <h6 class="mb-0">–°—Ç–∞—Ç—É—Å</h6>
                </div>
                <div class="col-md-2 text-center">
                    <h6 class="mb-0">–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</h6>
                </div>
                <div class="col-md-2 text-center">
                    <h6 class="mb-0">–î–µ–π—Å—Ç–≤–∏—è</h6>
                </div>
            </div>
        </div>
        
        {% for product_name, product_data in sklad.items() %}
        <div class="warehouse-item">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <div class="product-name">
                        <i class="fas fa-box me-2"></i>{{ product_name|title }}
                    </div>
                </div>
                <div class="col-md-2">
                    {% if product_data.get('—Ç–∏–ø', 'quantity') == 'availability' %}
                        <div class="input-group input-group-sm">
                            <button type="button" 
                                    class="form-control text-center" 
                                    onclick="setProductAvailable('{{ product_name }}')"
                                    title="–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –∫–∞–∫ –∏–º–µ—é—â–∏–π—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏"
                                    style="background-color: #f8f9fa !important; border-color: #ced4da !important; color: #495057 !important; cursor: pointer;"
                                    onmouseover="this.style.backgroundColor='#e9ecef'"
                                    onmouseout="this.style.backgroundColor='#f8f9fa'">
                                –ï–°–¢–¨
                            </button>
                        </div>
                    {% else %}
                        <div class="input-group input-group-sm">
                            <input type="number" 
                                   class="form-control quick-edit" 
                                   data-product="{{ product_name }}"
                                   value="{{ product_data.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ|format_number }}" 
                                   min="0" 
                                   step="{% if product_data.–µ–¥–∏–Ω–∏—Ü–∞ in ['—à—Ç', '–ø–∞–∫–µ—Ç–∏–∫', '–∫—É–±–∏–∫', '–±–∞–Ω–∫–∞', '—É–ø–∞–∫–æ–≤–∫–∞', '—à—Ç—É–∫–∞', '—à—Ç—É–∫'] %}1{% elif product_data.–µ–¥–∏–Ω–∏—Ü–∞ in ['–≥', '–º–ª', '–ª'] %}1{% else %}0.1{% endif %}">
                            <span class="input-group-text">{{ product_data.–µ–¥–∏–Ω–∏—Ü–∞ }}</span>
                        </div>
                    {% endif %}
                </div>
                <div class="col-md-2 text-center">
                    {% set expiration_status, expiration_text = get_product_expiration_status(product_data.get('—Å—Ä–æ–∫_–≥–æ–¥–Ω–æ—Å—Ç–∏')) %}
                    {% if product_data.get('—Å—Ä–æ–∫_–≥–æ–¥–Ω–æ—Å—Ç–∏') %}
                        {% if expiration_status == 'expired' %}
                            <span class="badge bg-danger">
                                <i class="fas fa-exclamation-triangle me-1"></i>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω
                            </span>
                        {% elif expiration_status == 'expires_today' %}
                            <span class="badge" style="background-color: #fd7e14; color: white;">
                                <i class="fas fa-exclamation-triangle me-1"></i>–°–µ–≥–æ–¥–Ω—è –∏—Å—Ç–µ–∫–∞–µ—Ç
                            </span>
                        {% elif expiration_status == 'expiring_soon' %}
                            <span class="badge bg-warning text-dark">
                                <i class="fas fa-exclamation-triangle me-1"></i>–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç
                            </span>
                        {% endif %}
                    {% endif %}
                </div>
                <div class="col-md-2 text-center">
                    {% if product_data.get('—Å—Ä–æ–∫_–≥–æ–¥–Ω–æ—Å—Ç–∏') %}
                        <input type="date" 
                               class="form-control form-control-sm expiration-date" 
                               data-product="{{ product_name }}"
                               value="{{ product_data.—Å—Ä–æ–∫_–≥–æ–¥–Ω–æ—Å—Ç–∏ }}"
                               style="font-size: 0.8rem;">
                    {% else %}
                        <input type="date" 
                               class="form-control form-control-sm expiration-date" 
                               data-product="{{ product_name }}"
                               placeholder="–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏"
                               style="font-size: 0.8rem;">
                    {% endif %}
                </div>
                <div class="col-md-2 text-center">
                    <button type="button" 
                            class="btn btn-outline-danger btn-sm" 
                            onclick="throwAwayProduct('{{ product_name }}')"
                            title="–í—ã–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç (—Å–±—Ä–æ—Å–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ 0)">
                        <i class="fas fa-trash me-1"></i>–í—ã–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
    <div class="text-center mt-5">
        <form method="POST" action="{{ url_for('update_products') }}" style="display: inline;">
            <button type="submit" class="btn btn-add" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å–∫–ª–∞–¥? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ:\n‚Ä¢ –£–¥–∞–ª–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Ä–µ—Ü–µ–ø—Ç–∞—Ö\n‚Ä¢ –î–æ–±–∞–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ —Ä–µ—Ü–µ–ø—Ç–æ–≤\n‚Ä¢ –û–±–Ω–æ–≤–∏—Ç –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏')">
                <i class="fas fa-sync-alt me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
            </button>
        </form>
    </div>
{% else %}
    <div class="empty-state">
        <i class="fas fa-box-open"></i>
        <h3>–°–∫–ª–∞–¥ –ø—É—Å—Ç</h3>
        <p>–û–±–Ω–æ–≤–∏—Ç–µ —Å–∫–ª–∞–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤–∏—Ç—å —Å –º—É–ª—å—Ç–∏–≤–∞—Ä–∫–æ–π</p>
        <form method="POST" action="{{ url_for('update_products') }}" style="display: inline;">
            <button type="submit" class="btn btn-add">
                <i class="fas fa-sync-alt me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
            </button>
        </form>
    </div>
{% endif %}

{% endif %}

{% endblock %}

{% block scripts %}
<script>



// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –±–ª—é–¥–∞ –∫–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–≥–æ
function cookMeal(mealName) {
    fetch('/api/cook_meal', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            meal_name: mealName
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setTimeout(() => {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
                const cookButton = document.querySelector(`button[onclick="cookMeal('${mealName}')"]`);
                if (cookButton) {
                    cookButton.innerHTML = '<i class="fas fa-check-circle me-2"></i>–ì–æ—Ç–æ–≤–æ';
                    cookButton.className = 'btn btn-success btn-custom btn-lg';
                    cookButton.disabled = true;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –±–ª—é–¥–∞
                const mealCard = document.querySelector(`.${mealName}`);
                if (mealCard) {
                    mealCard.classList.add('ready-meal');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Ä–µ—Ü–µ–ø—Ç–∞
                const recipeCard = document.getElementById(`recipe-${mealName}`);
                if (recipeCard) {
                    recipeCard.classList.add('ready-meal');
                    const readySection = recipeCard.querySelector('.col-md-6:last-child');
                    if (readySection) {
                        readySection.innerHTML = `
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="text-center">
                                    <span class="badge bg-success fs-5 p-3">
                                        <i class="fas fa-check-circle me-2"></i>–ì–æ—Ç–æ–≤–æ –∫ –ø–æ–¥–∞—á–µ
                                    </span>
                                </div>
                            </div>
                        `;
                    }
                }
            }, 1000);
        } else {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–∏:', data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
    });
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('.quick-edit');
    inputs.forEach(input => {
        input.addEventListener('change', function() {
            const product = this.dataset.product;
            const quantity = parseFloat(this.value);
            
            if (!isNaN(quantity) && quantity >= 0) {
                fetch(`/api/update/${encodeURIComponent(product)}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        quantity: quantity
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        const notification = document.createElement('div');
                        notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
                        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                        notification.innerHTML = `
                            <i class="fas fa-check-circle me-2"></i>
                            ${data.message}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        `;
                        document.body.appendChild(notification);
                        
                        // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 3000);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
                });
            }
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏
    const expirationInputs = document.querySelectorAll('.expiration-date');
    expirationInputs.forEach(input => {
        input.addEventListener('change', function() {
            const product = this.dataset.product;
            const expirationDate = this.value;
            
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–∞
            const quantityInput = document.querySelector(`input[data-product="${product}"]`);
            const currentQuantity = quantityInput ? parseFloat(quantityInput.value) || 0 : 0;
            
            fetch(`/api/update/${encodeURIComponent(product)}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    quantity: currentQuantity, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    expiration_date: expirationDate
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ–≥–æ —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏
                    updateProductStatus(product, expirationDate);
                } else {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏:', data.error);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏:', error);
            });
        });
    });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ 0
function throwAwayProduct(productName) {
    fetch(`/api/update/${encodeURIComponent(productName)}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                quantity: 0,
                expiration_date: null
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                const input = document.querySelector(`input[data-product="${productName}"]`);
                if (input) {
                    input.value = 0;
                }
                
                // –û—á–∏—â–∞–µ–º —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–∏—Å–∫
                let expirationInput = document.querySelector(`input.expiration-date[data-product="${productName}"]`);
                if (!expirationInput) {
                    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ - –∏—â–µ–º –ø–æ –≤—Å–µ–º input —Å data-product
                    const allInputs = document.querySelectorAll(`input[data-product="${productName}"]`);
                    expirationInput = Array.from(allInputs).find(input => input.classList.contains('expiration-date'));
                }
                
                if (!expirationInput) {
                    // –ï—â–µ –æ–¥–∏–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ - –∏—â–µ–º –ø–æ —Ç–∏–ø—É input[type="date"]
                    const allDateInputs = document.querySelectorAll(`input[type="date"][data-product="${productName}"]`);
                    if (allDateInputs.length > 0) {
                        expirationInput = allDateInputs[0];
                    }
                }
                
                if (expirationInput) {
                    expirationInput.value = '';
                    console.log(`–û—á–∏—â–µ–Ω —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è ${productName}`);
                } else {
                    console.log(`–ù–µ –Ω–∞–π–¥–µ–Ω input —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è ${productName}`);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞ (—Å–∫—Ä—ã–≤–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç –≤—ã–±—Ä–æ—à–µ–Ω)
                updateProductStatus(productName, null);
            } else {
                console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–Ω–∏–∏ ${productName}:`, data.error);
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –ø—Ä–æ—Å—Ç—ã–º –Ω–∞–ª–∏—á–∏–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–µ—Å—Ç—å"
function setProductAvailable(productName) {
    fetch(`/api/update/${encodeURIComponent(productName)}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            quantity: 1,
            expiration_date: null
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∏ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞
            const button = document.querySelector(`button[onclick="setProductAvailable('${productName}')"]`);
            if (button) {
                button.textContent = '–ï–°–¢–¨';
                button.style.backgroundColor = '#d4edda';
                button.style.color = '#155724';
                button.style.borderColor = '#c3e6cb';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞ (–±–µ–∑ —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏)
            updateProductStatus(productName, null);
        } else {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞–ª–∏—á–∏—è ${productName}:`, data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–∞ (–ø–æ–¥–±–∏—Ä–∞–µ—Ç –±–ª—é–¥–∞ —Å –º–∏–Ω–∏–º—É–º–æ–º –ø–æ–∫—É–ø–æ–∫, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–∏–µ–º—ã –ø–∏—â–∏)
function optimizeRecipe() {
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É
    const button = event.target.closest('button');
    
    // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
    if (button.disabled) {
        return;
    }
    
    const originalContent = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–ü–æ–¥–±–∏—Ä–∞–µ–º...';
    button.disabled = true;
    
    fetch('/api/optimize_recipe', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–ª—é–¥
            updateAllMealCards(data.optimized_recipe);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
            updateShoppingList(data.needed_products);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            button.innerHTML = originalContent;
            button.disabled = false;
        } else {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–∞:', data.error);
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            button.innerHTML = originalContent;
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        button.innerHTML = originalContent;
        button.disabled = false;
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–º–µ–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–ª—é–¥–∞
function replaceMeal(mealType) {
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É
    const button = event.target.closest('button');
    
    // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
    if (button.disabled) {
        return;
    }
    
    const originalContent = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    fetch('/api/replace_meal', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            meal_type: mealType
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–ª—é–¥–∞
            updateMealCard(mealType, data.new_meal_data);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
            updateShoppingList(data.needed_products);
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            button.innerHTML = originalContent;
            button.disabled = false;
        } else {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ –±–ª—é–¥–∞:', data.error);
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            button.innerHTML = originalContent;
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        button.innerHTML = originalContent;
        button.disabled = false;
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
function buyProduct(productName, neededAmount, unit) {
    const amount = prompt(`–°–∫–æ–ª—å–∫–æ ${productName} –≤—ã –∫—É–ø–∏–ª–∏? (–Ω—É–∂–Ω–æ: ${neededAmount} ${unit})`, neededAmount);
    
    if (amount !== null && !isNaN(parseFloat(amount)) && parseFloat(amount) >= 0) {
        const quantity = parseFloat(amount);
        
        // –°–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏
        const expirationDate = prompt(`–í–≤–µ–¥–∏—Ç–µ —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è ${productName} (YYYY-MM-DD) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º:`, '');
        
        fetch('/api/buy_single_product', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product: productName,
                quantity: quantity,
                unit: unit,
                product_type: 'quantity',
                expiration_date: expirationDate || null
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                setTimeout(() => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    const input = document.querySelector(`input[data-product="${productName}"]`);
                    if (input) {
                        input.value = quantity;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏
                    const expirationInput = document.querySelector(`input.expiration-date[data-product="${productName}"]`);
                    if (expirationInput && expirationDate) {
                        expirationInput.value = expirationDate;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞
                    updateProductStatus(productName, expirationDate);
                }, 1000);
            } else {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø—Ä–æ–¥—É–∫—Ç–∞:', data.error);
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        });
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –ø—Ä–æ—Å—Ç—ã–º –Ω–∞–ª–∏—á–∏–µ–º
function buyProductAvailability(productName, unit) {
    fetch('/api/buy_single_product', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product: productName,
                quantity: 1,
                unit: unit,
                product_type: 'availability',
                expiration_date: null
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                setTimeout(() => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∏ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞
                    const button = document.querySelector(`button[onclick="setProductAvailable('${productName}')"]`);
                    if (button) {
                        button.textContent = '–ï–°–¢–¨';
                        button.style.backgroundColor = '#d4edda';
                        button.style.color = '#155724';
                        button.style.borderColor = '#c3e6cb';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞ (–±–µ–∑ —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏)
                    updateProductStatus(productName, null);
                }, 1000);
            } else {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø—Ä–æ–¥—É–∫—Ç–∞:', data.error);
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –±–ª—é–¥–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function updateMealCard(mealType, mealData) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –º–µ–Ω—é
    const mealCards = document.querySelectorAll('.meal-card');
    mealCards.forEach(card => {
        const cardButton = card.querySelector(`button[onclick="replaceMeal('${mealType}')"]`);
        if (cardButton) {
            const dishElement = card.querySelector('.meal-dish');
            if (dishElement && mealData.–±–ª—é–¥–æ) {
                dishElement.textContent = mealData.–±–ª—é–¥–æ;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            cardButton.innerHTML = '<i class="fas fa-sync-alt"></i>';
            cardButton.disabled = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–Ω–µ –≥–æ—Ç–æ–≤–∏—Ç—å" –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
            const skipButton = document.getElementById(`skip-btn-${mealType}`);
            if (skipButton) {
                const skipStatus = mealData.skip_cooking || false;
                const icon = skipButton.querySelector('i');
                
                if (skipStatus) {
                    icon.className = 'fas fa-play';
                    skipButton.title = '–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ';
                    skipButton.className = 'btn btn-sm btn-outline-success';
                    card.classList.add('meal-card-skipped');
                } else {
                    icon.className = 'fas fa-pause';
                    skipButton.title = '–ù–µ –≥–æ—Ç–æ–≤–∏—Ç—å';
                    skipButton.className = 'btn btn-sm btn-outline-warning';
                    card.classList.remove('meal-card-skipped');
                }
            }
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ü–≤–µ—Ç–æ–≤–æ–π –∫–ª–∞—Å—Å —Ç–∏–ø–∞ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω
            const mealTypes = ['–∑–∞–≤—Ç—Ä–∞–∫', '–≤—Ç–æ—Ä–æ–π_–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫', '—É–∂–∏–Ω'];
            mealTypes.forEach(type => {
                if (type !== mealType) {
                    card.classList.remove(type);
                }
            });
            card.classList.add(mealType);
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Ä–µ—Ü–µ–ø—Ç–∞
    const recipeCard = document.getElementById(`recipe-${mealType}`);
    if (recipeCard && mealData.–±–ª—é–¥–æ) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –±–æ–ª—å—à–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        const mealTypes = ['–∑–∞–≤—Ç—Ä–∞–∫', '–≤—Ç–æ—Ä–æ–π_–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫', '—É–∂–∏–Ω'];
        mealTypes.forEach(type => {
            if (type !== mealType) {
                recipeCard.classList.remove(type);
            }
        });
        recipeCard.classList.add(mealType);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        const titleElement = recipeCard.querySelector('.product-header h4, .product-header h5');
        if (titleElement) {
            titleElement.innerHTML = `<i class="fas fa-utensils me-2"></i>${mealType.charAt(0).toUpperCase() + mealType.slice(1)}: ${mealData.–±–ª—é–¥–æ}`;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
        if (mealData.–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã) {
            const ingredientsList = recipeCard.querySelector('.ingredients-list ul');
            if (ingredientsList) {
                ingredientsList.innerHTML = '';
                mealData.–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã.forEach(ingredient => {
                    const li = document.createElement('li');
                    li.className = 'mb-1';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    const formatNumber = (num) => {
                        return Number.isInteger(num) ? num.toString() : num.toFixed(1).replace(/\.0$/, '');
                    };
                    
                    li.innerHTML = `
                        <i class="fas fa-circle me-2" style="color: #28a745; font-size: 0.8em;"></i>
                        ${ingredient.–ø—Ä–æ–¥—É–∫—Ç.charAt(0).toUpperCase() + ingredient.–ø—Ä–æ–¥—É–∫—Ç.slice(1)}: ${formatNumber(ingredient.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)} ${ingredient.–µ–¥–∏–Ω–∏—Ü–∞}
                    `;
                    ingredientsList.appendChild(li);
                });
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        if (mealData.–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏) {
            const instructionsList = recipeCard.querySelector('.instructions-list ol');
            if (instructionsList) {
                instructionsList.innerHTML = '';
                mealData.–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.forEach(instruction => {
                    const li = document.createElement('li');
                    li.className = 'mb-1';
                    li.textContent = instruction;
                    instructionsList.appendChild(li);
                });
            }
        }
        

    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –±–ª—é–¥ (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–∞)
function updateAllMealCards(optimizedRecipe) {
    if (!optimizedRecipe || !optimizedRecipe.–º–µ–Ω—é) return;
    
    Object.entries(optimizedRecipe.–º–µ–Ω—é).forEach(([mealType, mealData]) => {
        updateMealCard(mealType, mealData);
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫
function updateShoppingList(neededProducts) {
    const shoppingSection = document.getElementById('shopping-list-container');
    if (!shoppingSection) return;
    
    if (!neededProducts || Object.keys(neededProducts).length === 0) {
        // –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–µ –Ω—É–∂–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        shoppingSection.innerHTML = `
            <div class="col-12">
                <div class="empty-state">
                    <i class="fas fa-check-circle text-success"></i>
                    <h3>–í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –µ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–µ!</h3>
                    <p>üéâ –ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –ø–æ–∫—É–ø–∞—Ç—å</p>
                </div>
            </div>
        `;
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
    let newHTML = '';
    Object.entries(neededProducts).forEach(([product, info]) => {
        let statusBadge = '';
        if (info.—Ç–∏–ø === 'availability') {
            if (info.–µ—Å—Ç—å > 0) {
                statusBadge = '<span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>–ï—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏</span>';
            } else {
                statusBadge = '<span class="badge bg-danger"><i class="fas fa-exclamation-triangle me-1"></i>–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å</span>';
            }
        } else {
            if (info.–µ—Å—Ç—å >= info.–Ω—É–∂–Ω–æ) {
                statusBadge = '<span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ</span>';
            } else if (info.–µ—Å—Ç—å > 0) {
                statusBadge = '<span class="badge bg-warning text-dark"><i class="fas fa-exclamation-circle me-1"></i>–ù—É–∂–Ω–æ –¥–æ–∫—É–ø–∏—Ç—å</span>';
            } else {
                statusBadge = '<span class="badge bg-danger"><i class="fas fa-exclamation-triangle me-1"></i>–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å</span>';
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ (—É–±–∏—Ä–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ –∑–Ω–∞–∫–∏)
        const formatNumber = (num) => {
            return Number.isInteger(num) ? num.toString() : num.toFixed(1).replace(/\.0$/, '');
        };
        
        let productInfo = '';
        let secondaryInfo = '';
        let buttonOnClick = '';
        
        if (info.—Ç–∏–ø === 'availability') {
            productInfo = `<strong>–ù—É–∂–Ω–æ: ${info.–µ–¥–∏–Ω–∏—Ü–∞}</strong>`;
            if (info.–µ—Å—Ç—å > 0) {
                secondaryInfo = '<div class="info-display-secondary">–ï—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏</div>';
            }
            buttonOnClick = `buyProductAvailability('${product}', '${info.–µ–¥–∏–Ω–∏—Ü–∞}')`;
        } else {
            productInfo = `<strong>–ù—É–∂–Ω–æ: ${formatNumber(info.–Ω—É–∂–Ω–æ)} ${info.–µ–¥–∏–Ω–∏—Ü–∞}</strong>`;
            if (info.–µ—Å—Ç—å > 0) {
                secondaryInfo = `<div class="info-display-secondary">–ï—Å—Ç—å: ${formatNumber(info.–µ—Å—Ç—å)} ${info.–µ–¥–∏–Ω–∏—Ü–∞}</div>`;
            }
            buttonOnClick = `buyProduct('${product}', ${formatNumber(info.–Ω—É–∂–Ω–æ)}, '${info.–µ–¥–∏–Ω–∏—Ü–∞}')`;
        }
        
        newHTML += `
            <div class="col-12 col-sm-6 col-lg-4">
                <div class="product-card">
                    <div class="product-header">
                        <h5 class="mb-0">
                            <i class="fas fa-shopping-cart me-2"></i>${product.charAt(0).toUpperCase() + product.slice(1)}
                        </h5>
                    </div>
                    <div class="product-body">
                        <div class="mb-3">
                            <div class="text-center">
                                <div class="info-display">
                                    ${productInfo}
                                </div>
                                ${secondaryInfo}
                            </div>
                        </div>
                        
                        <div class="text-center mb-3">
                            ${statusBadge}
                        </div>
                        
                        <div class="d-grid">
                            <button class="btn btn-success btn-custom" onclick="${buttonOnClick}">
                                <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏–ª
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    shoppingSection.innerHTML = newHTML;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ "–Ω–µ –≥–æ—Ç–æ–≤–∏—Ç—å"
function toggleSkipCooking(mealType) {
    // –ü–æ–ª—É—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –æ–Ω–∞ —É–∂–µ
    const button = document.getElementById(`skip-btn-${mealType}`);
    
    // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
    if (button.disabled) {
        return;
    }
    
    const originalContent = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    fetch('/api/toggle_skip_cooking', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            meal_type: mealType
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –∏ –ø–æ–¥—Å–∫–∞–∑–∫—É –∫–Ω–æ–ø–∫–∏
            const icon = button.querySelector('i');
            const newStatus = data.skip_cooking;
            
            if (newStatus) {
                icon.className = 'fas fa-play';
                button.title = '–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ';
                button.className = 'btn btn-sm btn-outline-success';
            } else {
                icon.className = 'fas fa-pause';
                button.title = '–ù–µ –≥–æ—Ç–æ–≤–∏—Ç—å';
                button.className = 'btn btn-sm btn-outline-warning';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏
            const mealCard = button.closest('.meal-card');
            if (newStatus) {
                mealCard.classList.add('meal-card-skipped');
            } else {
                mealCard.classList.remove('meal-card-skipped');
            }
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ü–≤–µ—Ç–æ–≤–æ–π –∫–ª–∞—Å—Å —Ç–∏–ø–∞ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω
            const mealTypes = ['–∑–∞–≤—Ç—Ä–∞–∫', '–≤—Ç–æ—Ä–æ–π_–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫', '—É–∂–∏–Ω'];
            mealTypes.forEach(type => {
                if (type !== mealType) {
                    mealCard.classList.remove(type);
                }
            });
            mealCard.classList.add(mealType);
            
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            button.disabled = false;
        } else {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:', data.error);
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            button.innerHTML = originalContent;
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        button.innerHTML = originalContent;
        button.disabled = false;
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏
function updateProductStatus(productName, expirationDate) {
    // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±
    let expirationInput = document.querySelector(`input.expiration-date[data-product="${productName}"]`);
    if (!expirationInput) {
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ - –∏—â–µ–º –ø–æ –≤—Å–µ–º input —Å data-product
        const allInputs = document.querySelectorAll(`input[data-product="${productName}"]`);
        expirationInput = Array.from(allInputs).find(input => input.classList.contains('expiration-date'));
    }
    
    if (!expirationInput) {
        // –ï—â–µ –æ–¥–∏–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ - –∏—â–µ–º –ø–æ —Ç–∏–ø—É input[type="date"]
        const allDateInputs = document.querySelectorAll(`input[type="date"][data-product="${productName}"]`);
        if (allDateInputs.length > 0) {
            expirationInput = allDateInputs[0];
        }
    }
    
    if (!expirationInput) {
        console.log(`–ù–µ –Ω–∞–π–¥–µ–Ω input —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è ${productName} –≤ updateProductStatus`);
        return;
    }
    
    const warehouseItem = expirationInput.closest('.warehouse-item');
    if (!warehouseItem) {
        console.log(`–ù–µ –Ω–∞–π–¥–µ–Ω warehouse-item –¥–ª—è ${productName}`);
        return;
    }
    
    const statusBadge = warehouseItem.querySelector('.badge');
    if (!statusBadge) {
        console.log(`–ù–µ –Ω–∞–π–¥–µ–Ω badge –¥–ª—è ${productName}`);
        return;
    }
    
    // –ï—Å–ª–∏ —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ —É–∫–∞–∑–∞–Ω - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∏–∫–∞–∫–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
    if (!expirationDate) {
        statusBadge.style.display = 'none';
        return;
    }
    
    const today = new Date();
    const expDate = new Date(expirationDate);
    const daysUntilExpiration = Math.ceil((expDate - today) / (1000 * 60 * 60 * 24));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏
    if (daysUntilExpiration < 0) {
        statusBadge.className = 'badge bg-danger';
        statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω';
        statusBadge.style.display = 'inline-block';
    } else if (daysUntilExpiration === 0) {
        statusBadge.className = 'badge';
        statusBadge.style.backgroundColor = '#fd7e14';
        statusBadge.style.color = 'white';
        statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>–°–µ–≥–æ–¥–Ω—è –∏—Å—Ç–µ–∫–∞–µ—Ç';
        statusBadge.style.display = 'inline-block';
    } else if (daysUntilExpiration <= 2) {
        statusBadge.className = 'badge bg-warning text-dark';
        statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç';
        statusBadge.style.display = 'inline-block';
    } else {
        // –°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫–µ - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
        statusBadge.style.display = 'none';
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ —Ä–µ—Ü–µ–ø—Ç—É
function scrollToRecipe(mealName) {
    const recipeElement = document.getElementById('recipe-' + mealName);
    if (recipeElement) {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const offset = 100;
        const elementPosition = recipeElement.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - offset;
        
        window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —ç–ª–µ–º–µ–Ω—Ç–∞
        recipeElement.style.transition = 'all 0.3s ease';
        
        // –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–ª—é–¥
        if (recipeElement.classList.contains('ready-meal')) {
            // –ì–æ—Ç–æ–≤—ã–µ –±–ª—é–¥–∞ (–Ω–µ —Ç—Ä–µ–±—É—é—â–∏–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è)
            recipeElement.style.backgroundColor = '#e8f5e8';
            recipeElement.style.border = '2px solid #28a745';
        } else {
            // –ë–ª—é–¥–∞ –¥–ª—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
            recipeElement.style.backgroundColor = '#fff3cd';
            recipeElement.style.border = '2px solid #ffc107';
        }
        
        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            recipeElement.style.backgroundColor = '';
            recipeElement.style.border = '';
        }, 2000);
    } else {
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }
}
</script>
{% endblock %}
